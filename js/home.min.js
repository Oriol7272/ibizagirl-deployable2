(function(){
  console.log("🏠 home.min.js cargado");
  var U=window.IBG_UTIL||{}, $=U.$;
  function startRotation(list){
    var bannerImg=$('.banner .img'); if(!bannerImg) return;
    if(!list || !list.length){
      bannerImg.style.backgroundImage='url("decorative-images/paradise-beach.png")';
      bannerImg.style.opacity=.28; return;
    }
    var i=0; function rot(){
      bannerImg.style.opacity=0;
      var src=list[i%list.length];
      setTimeout(function(){
        bannerImg.style.backgroundImage='url("'+src+'")';
        bannerImg.style.opacity=.28;
      },220); i++;
    }
    rot(); setInterval(rot,4000);
  }
  document.addEventListener('DOMContentLoaded',function(){
    console.log("🌅 DOM listo; construyendo Home…");
    // Rotación banner
    fetch('decorative-images/manifest.json').then(r=>r.ok?r.json():null).then(j=>{
      var arr=j&&Array.isArray(j.images)?j.images:[]; var list=arr.map(n=>'decorative-images/'+n);
      startRotation(list.length?list:['decorative-images/paradise-beach.png']);
    }).catch(()=>startRotation(['decorative-images/paradise-beach.png']));

    // Carrusel 30
    var pub=window.CONTENT_PUBLIC||[];
    if(!Array.isArray(pub) || pub.length===0){
      console.warn("⚠️ CONTENT_PUBLIC vacío; ¿carga content-data2.js?");
      return;
    }
    var c30=(U.sample(pub,30)).map(x=>U.norm(x,'full'));
    var car=$('#carousel');
    if(car){
      c30.forEach(src=>{
        var img=new Image(); img.loading="lazy"; img.decoding="async"; img.src=src; car.appendChild(img);
      });
      console.log("🎠 Carrusel creado con", c30.length, "imágenes");
    }
    // Grid 40 sin repetir
    var used=new Set(c30.map(String));
    var rest=pub.map(x=>U.norm(x,'full')).filter(x=>!used.has(String(x)));
    var g40=U.sample(rest,40);
    var grid=$('#grid40');
    if(grid){
      g40.forEach(src=>{
        var d=document.createElement('div'); d.className='thumb';
        var img=new Image(); img.loading="lazy"; img.decoding="async"; img.src=src;
        d.appendChild(img); grid.appendChild(d);
      });
      console.log("🖼️ Galería creada con", g40.length, "imágenes");
    }
  });
})();
