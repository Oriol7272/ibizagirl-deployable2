<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Suscripción | IbizaGirl.pics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://www.paypal.com" />
  <link rel="stylesheet" href="/css/site.css?v=20250822194320" />
  <style>
    .plans { display:grid; gap:20px; max-width:900px; margin:40px auto; }
    .plan { background:#111; border:1px solid #222; border-radius:14px; padding:18px; box-shadow:0 6px 24px rgba(0,0,0,.25); }
    .plan h3 { margin:0 0 6px 0; font-size:20px; color:#cfe5ff; }
    .price { font-size:26px; margin:2px 0 6px; }
    .desc { opacity:.8; font-size:14px; margin-bottom:10px; }
    .btn-area { min-height:48px; display:flex; align-items:center; justify-content:flex-start; }
    .muted { opacity:.6; font-size:12px; margin-top:10px; }
    .row { display:grid; grid-template-columns:1fr; gap:16px; }
    @media (min-width:800px){ .row{ grid-template-columns:1fr 1fr 1fr; } }
    .tag { display:inline-block; background:#0e2b4a; color:#9fd0ff; font-size:12px; padding:3px 8px; border-radius:999px; margin-left:8px; }
    .btn { background:#0ea5e9; color:#001018; padding:10px 14px; border-radius:999px; text-decoration:none; font-weight:600; }
  </style>
</head>
<body>
  <header class="topnav">
    <a href="/">Home</a>
    <a href="/premium.html">Premium</a>
    <a href="/videos.html">Videos</a>
    <a class="active" href="/subscription.html">Suscripción</a>
  </header>

  <main class="container">
    <h1>Suscripciones</h1>
    <p>Desbloquea todas las fotos y vídeos sin límites.</p>

    <section class="plans">
      <div class="row">
        <div class="plan" id="plan-monthly">
          <h3>Mensual <span class="tag">14,99 €</span></h3>
          <div class="price">14,99 € <small>/ mes</small></div>
          <div class="desc">Acceso total recurrente. Cancela cuando quieras.</div>
          <div class="btn-area"><span class="loading">Cargando botón…</span></div>
          <div class="muted">Tras el pago, refresca la página si no ves todo desbloqueado al instante.</div>
        </div>

        <div class="plan" id="plan-annual">
          <h3>Anual <span class="tag">49,99 €</span></h3>
          <div class="price">49,99 € <small>/ año</small></div>
          <div class="desc">El mejor precio anual. Se renueva automáticamente.</div>
          <div class="btn-area"><span class="loading">Cargando botón…</span></div>
          <div class="muted">Puedes cancelar la renovación desde tu cuenta PayPal.</div>
        </div>

        <div class="plan" id="plan-lifetime">
          <h3>Lifetime <span class="tag">100 €</span></h3>
          <div class="price">100,00 € <small>pago único</small></div>
          <div class="desc">Acceso ilimitado para siempre, sin cuotas.</div>
          <div class="btn-area"><a class="btn" href="/premium.html#lifetime">Comprar vía Checkout</a></div>
          <div class="muted">El pago lifetime se procesa como “pago único” (no suscripción).</div>
        </div>
      </div>
    </section>
  </main>

  <script>
  (async function(){
    const cfgRes = await fetch('/api/config', {cache:'no-store'});
    const cfg = await cfgRes.json();
    if(!cfg.ok || !cfg.paypalClientId){
      console.error('PayPal config no disponible', cfg);
      document.querySelectorAll('.btn-area .loading').forEach(el => el.textContent = 'Config PayPal no disponible');
      return;
    }

    // Carga SDK PayPal con vault & intent=subscription
    const sdkUrl = new URL('https://www.paypal.com/sdk/js');
    sdkUrl.searchParams.set('client-id', cfg.paypalClientId);
    sdkUrl.searchParams.set('vault', 'true');
    sdkUrl.searchParams.set('intent', 'subscription');
    sdkUrl.searchParams.set('components', 'buttons');
    await new Promise((resolve, reject) => {
      const s = document.createElement('script');
      s.src = sdkUrl.toString();
      s.onload = resolve;
      s.onerror = reject;
      document.head.appendChild(s);
    });

    const renderButton = (container, planId) => {
      if(!planId){ container.textContent = 'Plan no configurado'; return; }
      container.innerHTML = '';
      paypal.Buttons({
        style: { layout:'horizontal', color:'gold', shape:'pill', label:'subscribe' },
        createSubscription: (data, actions) => actions.subscription.create({ plan_id: planId }),
        onApprove: (data) => {
          console.log('Subscription OK', data);
          alert('✅ Suscripción activada. ¡Gracias!');
          location.href = '/premium.html';
        },
        onError: (err) => {
          console.error('PayPal error:', err);
          alert('❌ Error con PayPal. Reintenta en un momento.');
        }
      }).render(container);
    };

    renderButton(document.querySelector('#plan-monthly .btn-area'), cfg.paypalPlanMonthly1499);
    renderButton(document.querySelector('#plan-annual  .btn-area'), cfg.paypalPlanAnnual4999);
  })();
  </script>
</body>
</html>
