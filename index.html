<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IbizaGirl.pics — Home</title>

  <link rel="stylesheet" href="/css/site.css?v=20250822133126">
  <link rel="stylesheet" href="/css/blur.css?v=20250822133126">

  <!-- Pools (contenido) -->
  <script src="/content-data1.js"></script>
  <script src="/content-data2.js"></script>
  <script src="/content-data3.js"></script>
  <script src="/content-data4.js"></script>
  <script src="/content-data5.js"></script>
  <script src="/content-data6.js"></script>

  <!-- Helpers -->
  <script src="/js/unified-helpers.js?v=20250822133126"></script>

  <style>
    :root{color-scheme:dark light}
    body{margin:0;background:#0c0c0f;color:#ddd;font:15px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .site-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #1c1c22}
    .site-header h1{margin:0;font-size:20px}
    .site-header nav a{color:#9fd3ff;text-decoration:none;margin-left:16px}
    .container{padding:18px 20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:16px}
    .card{position:relative;border-radius:14px;background:#111;box-shadow:0 6px 20px rgba(0,0,0,.35);overflow:hidden;min-height:150px}
    .card img{width:100%;height:100%;object-fit:cover;display:block;opacity:0;transition:opacity .3s ease}
    .card.ready img{opacity:1}
    .badge-premium{position:absolute;top:8px;left:-36px;transform:rotate(-18deg);background:#ffbf00;color:#111;
      font-weight:700;font-size:12px;padding:6px 38px;border-radius:8px;box-shadow:0 8px 18px rgba(0,0,0,.35)}
    .blurred{filter:blur(18px) brightness(.6)}
    footer{padding:18px 20px;border-top:1px solid #1c1c22;color:#888}
  </style>

  <!-- Crisp -->
  <script>
    window.$crisp=[]; window.CRISP_WEBSITE_ID="59e184b1-e679-4c93-b3ea-d60b63c1c04c";
    (function(){var d=document,s=d.createElement("script");s.src="https://client.crisp.chat/l.js";s.async=1;d.head.appendChild(s)})();
  </script>
</head>
<body>
  <header class="site-header">
    <h1>IbizaGirl.pics</h1>
    <nav>
      <a href="/premium.html">Premium</a>
      <a href="/videos.html">Vídeos</a>
      <a href="/subscription.html">Suscripción</a>
    </nav>
  </header>

  <main class="container">
    <h2>Galería (20 aleatorias de FULL)</h2>
    <div id="grid" class="grid"></div>
  </main>

  <footer>© IbizaGirl.pics</footer>

  <script>
    // ---------- utilidades ----------
    const FALLBACKS = ['bikini5.webp','W9CK51Mronx3uf5hfQ3U.webp']; // por si acaso
    const shuffle = arr => { for(let i=arr.length-1;i>0;i--){const j=(Math.random()*(i+1))|0; [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; };
    const pick = (arr, n) => shuffle(arr.slice()).slice(0,n);
    const isImg = s => typeof s==='string' && /\.(webp|jpg|jpeg|png)$/i.test(s);
    const normName = n => String(n).split('?')[0].split('/').pop(); // "full/foo.webp" -> "foo.webp"

    const toFull = n => '/full/' + normName(n);
    const toUnc  = n => '/uncensored/' + String(n).replace(/^uncensored\/?/i,'');

    function loadCheck(src, timeoutMs=3500){
      return new Promise(resolve=>{
        const img=new Image(); let done=false;
        const end=(ok)=>{ if(done) return; done=true; clearTimeout(t); img.onload=img.onerror=null; resolve(ok); };
        const t=setTimeout(()=>end(false), timeoutMs);
        img.onload=()=>end(true);
        img.onerror=()=>end(false);
        img.decoding='async'; img.loading='eager';
        img.src=src + (src.includes('?')?'&':'?') + 'cb=' + Date.now();
      });
    }

    function getPools(){
      const pools = (window.U && window.U.pools) || (window.UnifiedContentAPI && window.UnifiedContentAPI.pools) || {};
      return {
        full: Array.isArray(pools.full) ? pools.full : [],
        uncensored: Array.isArray(pools.uncensored) ? pools.uncensored : [],
      };
    }

    async function resolveFullWorking(max=20){
      const { full } = getPools();
      // ACEPTA "foo.webp" y "full/foo.webp"
      const list = full.filter(isImg).map(normName);
      const unique = [...new Set(list)];
      const order = shuffle(unique);

      const ok = [];
      for (const name of order) {
        if (ok.length >= max) break;
        if (await loadCheck(toFull(name))) ok.push(name);
      }
      return ok;
    }

    async function render(){
      // limpia SW/caches para evitar residuos
      try{
        if('serviceWorker' in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r=>r.unregister()));
        }
        if (window.caches) {
          const keys = await caches.keys();
          await Promise.all(keys.map(k=>caches.delete(k)));
        }
      }catch(_){}

      const grid = document.getElementById('grid');
      grid.innerHTML='';

      const fullOk = await resolveFullWorking(20);
      let finalFiles = fullOk.map(n => ({src: toFull(n), premium:false}));

      // Si por lo que sea hay menos de 20, rellena con blur premium
      if (finalFiles.length < 20) {
        const { uncensored } = getPools();
        const need = 20 - finalFiles.length;
        const fill = pick(uncensored.filter(isImg), Math.min(need, uncensored.length))
                      .map(n => ({src: toUnc(n), premium:true}));
        finalFiles = finalFiles.concat(fill);
        console.warn(`⚠️ Home: FULL válidas ${fullOk.length}, relleno ${fill.length} premium blur.`);
      }

      console.log('index: render con', finalFiles.length, 'items');

      for (const item of finalFiles) {
        const fig = document.createElement('figure'); fig.className='card';
        const img = document.createElement('img');
        img.alt='IbizaGirl'; img.loading='lazy'; img.decoding='async';
        img.src = item.src;

        if (item.premium) {
          img.classList.add('blurred');
          const badge = document.createElement('div');
          badge.className='badge-premium'; badge.textContent='Premium';
          fig.appendChild(badge);
        }

        img.addEventListener('load', ()=>{ fig.classList.add('ready'); }, {once:true});
        img.addEventListener('error', ()=>{ img.onerror=null; img.src=toFull(FALLBACKS[0]); fig.classList.add('ready'); }, {once:true});

        fig.appendChild(img);
        grid.appendChild(fig);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', render, {once:true});
    } else {
      render();
    }
  </script>

  <!-- PopAds -->
  <script type="text/javascript" data-cfasync="false">
  (function(){
    var k=window,g="e494ffb82839a29122608e933394c091",
      b=[["siteId",603*110+885*526-923+4695841],["minBid",0],["popundersPerIP","0"],["delayBetween",0],["default",false],["defaultPerDay",0],["topmostLayer","auto"]],
      t=["d3d3LnByZW1pdW12ZXJ0aXNpbmcuY29tL0xta2ZoUi90Vy9wdGFibGV0b3AubWluLmpz",
         "ZDJqMDQyY2oxNDIxd2kuY2xvdWRmcm9udC5uZXQvZ21kYi5taW4uanM=",
         "d3d3Lmd5dHphYnpmbGpnY3kuY29tL1RsTUd5di9JcC9vdGFibGV0b3AubWluLmpz",
         "d3d3LmRiaHFyYWlocHltLmNvbS91bWRiLm1pbi5qcw=="],
      r=-1,e,a,x=function(){clearTimeout(a);r++;if(t[r]&&!(1781762654000<(new Date).getTime()&&1<r)){e=k.document.createElement("script");e.type="text/javascript";e.async=!0;var p=k.document.getElementsByTagName("script")[0];e.src="https://"+atob(t[r]);e.crossOrigin="anonymous";e.onerror=x;e.onload=function(){clearTimeout(a);k[g.slice(0,16)+g.slice(0,16)]||x()};a=setTimeout(x,5E3);p.parentNode.insertBefore(e,p)}};
    if(!k[g]){try{Object.freeze(k[g]=b)}catch(e){}x()}
  })();
  </script>
</body>
</html>
