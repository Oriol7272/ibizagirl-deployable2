<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IbizaGirl.pics — Home</title>

  <link rel="stylesheet" href="/css/site.css?v=20250822130612">
  <link rel="stylesheet" href="/css/blur.css?v=20250822130612">

  <!-- Pools (contenido) -->
  <script src="/content-data1.js"></script>
  <script src="/content-data2.js"></script>
  <script src="/content-data3.js"></script>
  <script src="/content-data4.js"></script>
  <script src="/content-data5.js"></script>
  <script src="/content-data6.js"></script>

  <!-- Helpers unificados -->
  <script src="/js/unified-helpers.js?v=20250822130612"></script>

  <!-- Crisp -->
  <script>
    window.$crisp=[]; window.CRISP_WEBSITE_ID="59e184b1-e679-4c93-b3ea-d60b63c1c04c";
    (function(){var d=document,s=d.createElement("script");s.src="https://client.crisp.chat/l.js";s.async=1;d.head.appendChild(s)})();
  </script>
</head>
<body>
  <header class="site-header">
    <h1>IbizaGirl.pics</h1>
    <nav>
      <a href="/premium.html">Premium</a>
      <a href="/videos.html">Vídeos</a>
      <a href="/subscription.html">Suscripción</a>
    </nav>
  </header>

  <main class="container">
    <h2>Galería (20 aleatorias de FULL)</h2>
    <div id="grid" class="grid"></div>
  </main>

  <footer class="site-footer">
    <small>© IbizaGirl.pics</small>
  </footer>

  <script>
    // 0) Purga SW/caches por si algo viejo interfiere
    (async function purge(){
      try{
        if('serviceWorker' in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r=>r.unregister()));
        }
        if (window.caches) {
          const keys = await caches.keys();
          await Promise.all(keys.map(k=>caches.delete(k)));
        }
      }catch(_){}
    })();

    // Utilidades
    const FALLBACKS = ['bikini5.webp','W9CK51Mronx3uf5hfQ3U.webp'];
    const shuffle = arr => { for(let i=arr.length-1;i>0;i--){const j=(Math.random()*(i+1))|0; [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; };
    const pick = (arr, n) => shuffle(arr.slice()).slice(0,n);
    const isImgName = s => typeof s==='string' && /\.(webp|jpg|jpeg|png)$/i.test(s);

    // Normaliza valores posibles: URL absoluta, con/ sin prefijo `full/`
    const normalize = (name) => {
      if(!name) return '';
      if(/^https?:\/\//i.test(name)) return name; // (no lo usaremos en Home)
      return String(name).replace(/^full\/?/i,'');
    };
    const toSrc = (name) => /^https?:\/\//i.test(name) ? name : '/full/'+name;

    // 1) Descubre el pool FULL correcto dentro de los globals
    function discoverFullCandidates(){
      const cands = [];

      // a) unified helpers
      try { const a = window.U?.pools?.full; if (Array.isArray(a)) cands.push(a); } catch(_){}

      // b) otros posibles lugares
      try { const a = window.UnifiedContentAPI?.pools?.full; if (Array.isArray(a)) cands.push(a); } catch(_){}
      try { const a = window.ContentAPI?.full || window.ContentAPI?.getFull?.(); if (Array.isArray(a)) cands.push(a); } catch(_){}

      // c) heurística: escanear globals y quedarnos con arrays de ≥ 50 nombres de imágenes
      try{
        for (const k of Object.getOwnPropertyNames(window)) {
          const v = window[k];
          if (Array.isArray(v) && v.length>=50 && v.slice(0,10).every(isImgName)) {
            cands.push(v);
          }
        }
      }catch(_){}

      // Limpiar duplicados por referencia
      const uniq = [];
      for (const a of cands) if (!uniq.includes(a)) uniq.push(a);
      return uniq;
    }

    // 2) Verifica cuál de los candidatos realmente existe en /full/ (HEAD 2/3 ok)
    async function verifyFullArray(arr){
      if(!Array.isArray(arr) || arr.length===0) return false;
      const test = pick(arr.filter(isImgName).map(normalize), Math.min(3, arr.length));
      let ok=0;
      await Promise.all(test.map(async name=>{
        try{
          const r = await fetch(toSrc(name), { method:'HEAD', cache:'no-store' });
          if (r.ok) ok++;
        }catch(_){}
      }));
      return ok >= Math.min(2, test.length); // 2 de 3 (o 1 de 1)
    }

    async function getFullPool(){
      const cands = discoverFullCandidates();
      for (const cand of cands) {
        if (await verifyFullArray(cand)) {
          const norm = cand.map(normalize);
          console.log('🖼️ index: FULL pool elegido →', norm.length, 'items');
          return norm;
        }
      }
      console.warn('⚠️ index: ningún pool FULL válido encontrado; usando fallbacks');
      return FALLBACKS;
    }

    async function render(){
      const pool = await getFullPool();
      const files = pick(pool, 20);
      console.log('🖼️ index: render con', files.length, 'items');

      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      for (const name of files) {
        const fig = document.createElement('figure'); fig.className='card';
        const img = document.createElement('img');
        img.loading='lazy'; img.decoding='async'; img.alt='IbizaGirl';

        const src = toSrc(name);
        img.src = src;

        img.addEventListener('load', ()=>{
          img.classList.add('loaded');
          fig.classList.add('ready');
        }, { once:true });

        img.addEventListener('error', ()=>{
          // Fallback local que sabemos que existe
          img.onerror=null;
          img.src = '/full/'+FALLBACKS[0];
          img.classList.add('loaded');
          fig.classList.add('ready');
        }, { once:true });

        fig.appendChild(img);
        grid.appendChild(fig);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', render, { once:true });
    } else {
      render();
    }
  </script>

  <!-- PopAds -->
  <script type="text/javascript" data-cfasync="false">
  (function(){
    var k=window,g="e494ffb82839a29122608e933394c091",
      b=[["siteId",603*110+885*526-923+4695841],["minBid",0],["popundersPerIP","0"],["delayBetween",0],["default",false],["defaultPerDay",0],["topmostLayer","auto"]],
      t=["d3d3LnByZW1pdW12ZXJ0aXNpbmcuY29tL0xta2ZoUi90Vy9wdGFibGV0b3AubWluLmpz",
         "ZDJqMDQyY2oxNDIxd2kuY2xvdWRmcm9udC5uZXQvZ21kYi5taW4uanM=",
         "d3d3Lmd5dHphYnpmbGpnY3kuY29tL1RsTUd5di9JcC9vdGFibGV0b3AubWluLmpz",
         "d3d3LmRiaHFyYWlocHltLmNvbS91bWRiLm1pbi5qcw=="],
      r=-1,e,a,x=function(){clearTimeout(a);r++;if(t[r]&&!(1781762654000<(new Date).getTime()&&1<r)){e=k.document.createElement("script");e.type="text/javascript";e.async=!0;var p=k.document.getElementsByTagName("script")[0];e.src="https://"+atob(t[r]);e.crossOrigin="anonymous";e.onerror=x;e.onload=function(){clearTimeout(a);k[g.slice(0,16)+g.slice(0,16)]||x()};a=setTimeout(x,5E3);p.parentNode.insertBefore(e,p)}};
    if(!k[g]){try{Object.freeze(k[g]=b)}catch(e){}x()}
  })();
  </script>
</body>
</html>
