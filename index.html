<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>IbizaGirl.pics — Home</title>
  <link rel="stylesheet" href="/css/site.css"/>
  <style>
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:16px}
    .card{background:#111;border-radius:14px;padding:8px;box-shadow:0 0 0 1px #222}
    .card img{width:100%;height:180px;object-fit:cover;border-radius:10px;display:block}
    .muted{opacity:.65}
    .topnav{display:flex;gap:16px;margin:12px 0}
    .topnav a{color:#86b7ff;text-decoration:none}
  </style>

  <!-- Cargador robusto: intenta /content-dataX.js y si 404, prueba /js/content-dataX.js -->
  <script>
    (function robustLoader(){
      const ver = Date.now(); // cache-bust
      function add(srcPrimary, srcFallback){
        const s = document.createElement('script');
        s.defer = true;
        s.src = srcPrimary + '?v=' + ver;
        s.onerror = () => {
          const f = document.createElement('script');
          f.defer = true;
          f.src = srcFallback + '?v=' + ver;
          document.head.appendChild(f);
        };
        document.head.appendChild(s);
      }
      add('/content-data1.js', '/js/content-data1.js');
      add('/content-data2.js', '/js/content-data2.js');
      add('/content-data3.js', '/js/content-data3.js');
      add('/content-data4.js', '/js/content-data4.js');
      add('/content-data5.js', '/js/content-data5.js');
      add('/content-data6.js', '/js/content-data6.js');
    })();
  </script>
</head>
<body>
  <div class="topnav">
    <a href="/">Home</a>
    <a href="/premium">Premium</a>
    <a href="/videos">Vídeos</a>
    <a href="/subscription">Suscripción</a>
  </div>

  <h1>Galería (20 aleatorias de FULL)</h1>
  <div id="gallery" class="grid"></div>
  <p id="status" class="muted"></p>

  <script>
    // util aleatoria diaria (misma mezcla durante el día)
    function dailyShuffle(arr){
      const seedStr = new Date().toISOString().slice(0,10);
      let s = 0; for (let i=0;i<seedStr.length;i++) s = (s*31 + seedStr.charCodeAt(i))>>>0;
      const a = arr.slice();
      for (let i=a.length-1;i>0;i--){
        s = (s*1664525 + 1013904223)>>>0;
        const j = s % (i+1);
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    // Espera a que se carguen los content-data*
    (function boot(){
      const triesMax = 60; // ~6s
      let t = 0;
      const iv = setInterval(() => {
        const pool = (window.FULL_IMAGES_POOL || window.FULL || []);
        if (Array.isArray(pool) && pool.length){
          clearInterval(iv);
          render(pool);
        } else if (++t >= triesMax){
          clearInterval(iv);
          document.getElementById('status').textContent =
            'No se han encontrado imágenes FULL.';
          console.log('Home: FULL pool = 0 | render = 0');
        }
      }, 100);
    })();

    function normPath(p){
      if (!p) return '';
      if (p.startsWith('/')) return p;
      // si ya viene con 'full/' lo respetamos; si no, lo añadimos
      return p.startsWith('full/') ? '/' + p : '/full/' + p;
    }

    function render(pool){
      const pick = dailyShuffle(pool).slice(0,20);
      const el = document.getElementById('gallery');
      pick.forEach(item=>{
        const src = typeof item === 'string' ? item : (item.path||item.src||item.url||'');
        const href = normPath(src);
        const img = document.createElement('img');
        img.loading = 'lazy';
        img.alt = 'IbizaGirl';
        img.src = href;
        const card = document.createElement('a');
        card.href = href;
        card.target = '_blank';
        const wrap = document.createElement('div');
        wrap.className = 'card';
        card.appendChild(img);
        wrap.appendChild(card);
        el.appendChild(wrap);
      });
      document.getElementById('status').textContent =
        `© IbizaGirl.pics — render con ${pick.length} items`;
      console.log('Home FULL: pool', pool.length, '| render', pick.length);
    }
  </script>
</body>
</html>
